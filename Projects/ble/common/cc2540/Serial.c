/******************************************************************************

                  版权所有 (C), 2013-2020, 深圳市馒头科技有限公司

 ******************************************************************************
  文 件 名   : Serial.c
  版 本 号   : V1.0
  作    者   :  谢贤斌
  生成日期   : 2014年7月5日
  功能描述   : 串口驱动应用层实现
  函数列表   :
  修改历史   :
  1.日    期   : 2014年7月5日
    作    者   :  谢贤斌
    修改内容   : 创建文件

******************************************************************************/

/*----------------------------------------------*
 * 包含头文件                                   *
 *----------------------------------------------*/
#include <stdio.h>
#include "stdlib.h"
#include "string.h"
#include "osal.h"
#include "hal_uart.h"

/*----------------------------------------------*
 * 宏定义                                       *
 *----------------------------------------------*/
#define     PRINT_BUF_LEN               128

/*----------------------------------------------*
 * 数据类型                                     *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 外部变量说明                                 *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 内部函数原型说明                             *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 全局变量                                     *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 模块级变量                                   *
 *----------------------------------------------*/

/*----------------------------------------------*
 * 常量定义                                     *
 *----------------------------------------------*/


/*****************************************************************************
 函 数 名  : SerialPrintf
 功能描述  : 串口打印函数
 输入参数  : const char*fmt
             ...
 输出参数  : 无
 返 回 值  :

 修改历史      :
  1.日    期   : 2014年7月5日
    作    者   :  谢贤斌
    修改内容   : 创建

*****************************************************************************/
int SerialPrintf(const char*fmt, ...)
{
    uint32  ulLen;
    va_list ap;

    char *pBuf = (char*)osal_mem_alloc(PRINT_BUF_LEN);  // 开辟缓冲区
    if(pBuf == NULL)
    {
        return 0;
    }
    va_start(ap, fmt);
    ulLen = vsprintf(pBuf, fmt, ap);        // 用虚拟打印函数实现
    va_end(ap);

    HalUARTWrite(HAL_UART_PORT_0, (uint8*)pBuf, ulLen); // 从串口0输出
    osal_mem_free(pBuf);    // 释放内存空间
    return ulLen;
}


